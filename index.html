<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UPI QR Payment</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const VPA = 'BHARATPE.8K0T0X8C8U10501@fbpe';
        const PAYEE_NAME = 'sourav kumar';
        const WHATSAPP_NUMBER = '919060808433';

        const FullScreenQRModal = ({ amount, fixedQrCodeUrl, staticQrCodeUrl, vpa, onClose }) => {
            const [isCopied, setIsCopied] = useState(false);

            const handleCopyVpa = () => {
                navigator.clipboard.writeText(vpa).then(() => {
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                });
            };

            const parsedAmount = parseFloat(amount);

            return (
                <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl shadow-xl max-w-full w-full h-full max-h-full overflow-y-auto p-8 text-center relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                        
                        <h2 className="text-3xl font-bold text-gray-800 mb-6">Pay ₹{amount}</h2>

                        <div className="mb-10">
                            <p className="text-xl font-bold text-green-700 mb-4">Primary: Exact Amount QR</p>
                            <img src={fixedQrCodeUrl} alt="Fixed Amount QR" className="w-full max-w-lg mx-auto border-8 border-green-500 rounded-2xl shadow-2xl" />
                            <p className="text-lg mt-4">Scan with camera → Amount pre-filled</p>
                        </div>

                        {parsedAmount > 2000 && (
                            <div className="bg-yellow-100 border-2 border-yellow-400 p-6 rounded-xl mb-8 text-left max-w-2xl mx-auto">
                                <p className="font-bold text-yellow-800 text-lg mb-3">⚠️ For payments above ₹2000:</p>
                                <ul className="list-disc list-inside space-y-2 text-yellow-700">
                                    <li>Some apps limit "Scan from Gallery" to ₹2000.</li>
                                    <li><strong>Recommended:</strong> Scan live with your camera (no limit).</li>
                                    <li>Or use the manual QR below.</li>
                                </ul>
                            </div>
                        )}

                        <div className="mb-10">
                            <p className="text-xl font-bold text-blue-700 mb-4">Backup: Manual Entry QR (Works for Any Amount)</p>
                            <img src={staticQrCodeUrl} alt="Static QR" className="w-full max-w-lg mx-auto border-8 border-blue-500 rounded-2xl shadow-2xl" />
                            <p className="text-lg mt-4">Scan → Enter ₹{amount} manually</p>
                        </div>

                        <div className="bg-green-50 p-6 rounded-xl max-w-2xl mx-auto">
                            <p className="font-bold text-lg mb-3">Easy Steps:</p>
                            <ol className="list-decimal list-inside space-y-3 text-left">
                                <li>Screenshot this screen (for gallery scan if under ₹2000).</li>
                                <li>Or scan live with your UPI app camera.</li>
                                <li>Pay the amount → Done!</li>
                            </ol>
                        </div>

                        <div className="mt-8 flex items-center justify-center gap-4">
                            <p className="text-gray-700 text-lg">UPI ID: <strong className="font-mono text-xl">{vpa}</strong></p>
                            <button onClick={handleCopyVpa} className="p-3 bg-gray-200 rounded-lg hover:bg-gray-300">
                                {isCopied ? <span className="text-green-600 font-bold text-lg">Copied!</span> : 
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [amount, setAmount] = useState('');
            const [note, setNote] = useState('');
            const [utr, setUtr] = useState('');
            const [isCopied, setIsCopied] = useState(false);
            const [paymentHistory, setPaymentHistory] = useState([]);
            const [isMobile, setIsMobile] = useState(false);
            const [showModal, setShowModal] = useState(false);

            useEffect(() => {
                const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                setIsMobile(isMobileDevice);
                
                try {
                    const storedHistory = localStorage.getItem('paymentHistory');
                    if (storedHistory) setPaymentHistory(JSON.parse(storedHistory));
                } catch (error) {
                    localStorage.removeItem('paymentHistory');
                }
            }, []);

            const isAmountValid = useMemo(() => {
                const num = parseFloat(amount);
                return !isNaN(num) && num > 0;
            }, [amount]);

            const isUtrValid = useMemo(() => utr.trim().length > 0, [utr]);

            const fixedUpiUri = useMemo(() => {
                const params = new URLSearchParams({ pa: VPA, pn: PAYEE_NAME, cu: 'INR' });
                if (isAmountValid) params.set('am', parseFloat(amount).toFixed(2));
                params.set('tn', note.trim() || 'Payment');
                return `upi://pay?${params.toString()}`;
            }, [amount, note, isAmountValid]);

            const staticUpiUri = useMemo(() => {
                const params = new URLSearchParams({ pa: VPA, pn: PAYEE_NAME, cu: 'INR', tn: note.trim() || 'Payment' });
                return `upi://pay?${params.toString()}`;
            }, [note]);

            const fixedQrCodeUrl = useMemo(() => `https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=${encodeURIComponent(fixedUpiUri)}`, [fixedUpiUri]);
            const staticQrCodeUrl = useMemo(() => `https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=${encodeURIComponent(staticUpiUri)}`, [staticUpiUri]);

            const statusMessage = useMemo(() => isAmountValid ? `Ready to pay ₹${parseFloat(amount).toFixed(2)}` : 'Enter amount to generate QR codes', [amount, isAmountValid]);
            
            const addPaymentToHistory = () => {
                if (!isAmountValid) return;
                const newPayment = { id: new Date().toISOString(), amount: parseFloat(amount).toFixed(2), note: note.trim() || 'Payment', date: new Date().toLocaleString() };
                const updatedHistory = [newPayment, ...paymentHistory].slice(0, 5);
                setPaymentHistory(updatedHistory);
                localStorage.setItem('paymentHistory', JSON.stringify(updatedHistory));
            };

            const handleShowQR = () => {
                if (!isAmountValid) return;
                addPaymentToHistory();
                setShowModal(true);
            };

            const handleCopyVpa = () => {
                navigator.clipboard.writeText(VPA).then(() => {
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                });
            };

            const handleClearHistory = () => {
                setPaymentHistory([]);
                localStorage.removeItem('paymentHistory');
            };

            const handleWhatsAppShare = () => {
                let message = `Payment completed!\n\nAmount: ₹${parseFloat(amount).toFixed(2)}\n`;
                if (note.trim()) message += `Note: ${note.trim()}\n`;
                message += `UTR: ${utr.trim()}\n\nScreenshot attached. Thank you!`;
                const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            };

            return (
                <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                    {showModal && <FullScreenQRModal amount={parseFloat(amount).toFixed(2)} fixedQrCodeUrl={fixedQrCodeUrl} staticQrCodeUrl={staticQrCodeUrl} vpa={VPA} onClose={() => setShowModal(false)} />}
                    <div className="bg-white p-8 rounded-2xl shadow-2xl max-w-2xl w-full">
                        <h1 className="text-4xl font-bold text-center text-gray-800 mb-8">UPI QR Payment</h1>
                        
                        <div className="text-center mb-8">
                            <p className="text-gray-700 text-xl">Pay to: <strong className="font-mono text-2xl">{VPA}</strong></p>
                            <button onClick={handleCopyVpa} className="mt-3 text-blue-600 hover:text-blue-800 font-bold text-lg">
                                {isCopied ? 'Copied!' : 'Copy UPI ID'}
                            </button>
                            <p className="text-gray-600 mt-3 text-lg">Merchant: {PAYEE_NAME} (BharatPe)</p>
                        </div>

                        <div className="bg-green-50 border-2 border-green-300 p-6 rounded-xl mb-10 text-center">
                            <p className="font-bold text-xl text-green-800 mb-4">100% QR-Based (No Direct Links)</p>
                            <ul className="list-disc list-inside space-y-2 text-green-700 text-lg">
                                <li>No UPI intent buttons → No errors or restrictions</li>
                                <li>Works for any amount (including >₹2000)</li>
                                <li>Scan live or from screenshot</li>
                            </ul>
                        </div>

                        <div className="space-y-6 mb-10">
                            <div>
                                <label className="block text-left font-bold text-gray-700 text-xl mb-2">Amount (₹) <span className="text-red-500">*</span></label>
                                <input type="number" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder="e.g. 5000" className="w-full p-5 text-xl border-2 border-gray-300 rounded-xl focus:border-green-500" />
                            </div>
                            <div>
                                <label className="block text-left font-bold text-gray-700 text-xl mb-2">Note (optional)</label>
                                <input type="text" value={note} onChange={(e) => setNote(e.target.value)} placeholder="e.g. Order #123" className="w-full p-5 text-xl border-2 border-gray-300 rounded-xl focus:border-green-500" />
                            </div>
                        </div>

                        {isMobile && (
                            <button onClick={handleShowQR} disabled={!isAmountValid} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-6 rounded-xl text-2xl mb-8">
                                Show Full-Screen QR →
                            </button>
                        )}

                        <div className="text-center text-blue-700 font-bold text-xl p-5 bg-blue-50 rounded-xl mb-10">{statusMessage}</div>

                        {isAmountValid && (
                            <>
                                <div className="text-center mb-12">
                                    <p className="font-bold text-2xl text-gray-800 mb-6">Primary QR: Exact Amount Pre-filled</p>
                                    <img src={fixedQrCodeUrl} alt="Fixed Amount QR" className="w-full max-w-md mx-auto border-8 border-green-500 rounded-2xl shadow-2xl" />
                                    <p className="text-xl text-gray-600 mt-6">Scan → Pay instantly</p>
                                </div>

                                <div className="text-center">
                                    <p className="font-bold text-2xl text-gray-800 mb-6">Backup QR: Manual Entry (Any Amount)</p>
                                    <img src={staticQrCodeUrl} alt="Static QR" className="w-full max-w-md mx-auto border-8 border-blue-500 rounded-2xl shadow-2xl" />
                                    <p className="text-xl text-gray-600 mt-6">Scan → Enter amount manually</p>
                                </div>
                            </>
                        )}

                        {paymentHistory.length > 0 && (
                            <div className="mt-12 border-t-4 pt-10">
                                <div className="flex justify-between mb-6">
                                    <h2 className="text-2xl font-bold">Recent Payments</h2>
                                    <button onClick={handleClearHistory} className="text-red-600 hover:text-red-800 font-bold text-lg">Clear</button>
                                </div>
                                <div className="space-y-6">
                                    {paymentHistory.map((p) => (
                                        <div key={p.id} className="bg-gray-50 p-6 rounded-xl flex justify-between items-center">
                                            <div>
                                                <p className="font-bold text-2xl">₹{p.amount}</p>
                                                <p className="text-gray-600 text-lg">{p.note}</p>
                                            </div>
                                            <p className="text-gray-500 text-base">{p.date}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="mt-12 border-t-4 pt-10">
                            <label className="block text-left font-bold text-gray-700 text-xl mb-3">UTR / Reference No. <span className="text-red-500">*</span></label>
                            <input type="text" value={utr} onChange={(e) => setUtr(e.target.value)} placeholder="Enter 12-digit UTR" className="w-full p-5 text-xl border-2 border-gray-300 rounded-xl mb-6" />
                            <button onClick={handleWhatsAppShare} disabled={!isAmountValid || !isUtrValid} className="w-full bg-[#25D366] hover:bg-[#128C7E] disabled:bg-gray-400 text-white font-bold py-6 rounded-xl flex items-center justify-center gap-5 text-2xl">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-10 w-10" viewBox="0 0 24 24" fill="currentColor"><path d="M19.3 4.8C17.2 2.7 14.7 1.5 12 1.5c-5.5 0-10 4.5-10 10 0 1.8.5 3.5 1.4 5.1L2 22l5.5-1.4c1.5.8 3.2 1.3 4.9 1.3h.1c5.5 0 10-4.5 10-10 .1-2.7-1.1-5.2-3.2-7.2zm-1.6 11.7c-.2.3-.8.7-1.3.8-.4.1-.9.1-1.4-.1-1.3-.4-2.5-1-4.2-2.3-2-1.5-3.3-3.4-3.8-4-.5-.6-.1-1 .3-1.4.3-.3.6-.8.8-1s.3-.4.5-.7c.2-.3.1-.6 0-.8l-1.4-3.4c-.2-.5-.5-.6-.8-.6-.2 0-.5 0-.7 0-.3 0-.7.1-1 .6s-1.3 1.5-1.3 3.5 1.3 5.3 1.5 5.7c.2.4 2.8 4.4 6.8 6 1 .4 1.8.6 2.4.8.8.2 1.5.1 2.1-.2.7-.3 2.1-1.4 2.4-2.7s.3-2.5.2-2.7c-.1-.2-.4-.3-.7-.5z" /></svg>
                                Send Proof on WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
